# grafana-snapshooter
Tool for automated Grafana snapshot creation.

##Description
Dockerized Node app uses headless Chrome with Google [Puppeteer Framework](https://github.com/puppeteer/puppeteer/blob/master/docs/api.md) to login via Grafana UI and create snapshot in a regular way.
__NOTE__: That is temporary workaround as Grafana snapshot API still requires too much additional steps for datapoints retrieval (see Grafana blog [post](https://community.grafana.com/t/snapshot-api-how-to-get-the-data/2424/2))
###Prerequisites 
-Grafana v.5.1.3+
-Grafana User with admin permissions for target dashboard
-Docker
-NodeJS 8.0+ (for local execution)

##Usage
After running a container you can find a json file in ./results folder with created snapshot details.
__Example:__
 ```
 {
   "deleteKey": "autogenerated_key",
   "deleteUrl": "http://grafana.net/grafana/api/snapshots-delete/autogenerated_key",
   "key": "autogenerated_key",
   "url": "http://grafana.net/grafana/dashboard/snapshot/autogenerated_key"
 }
 ```

### NOTE:
Snapshotting is time consuming operation, choose appropriate time range and panels number.
Snapshot creation may fail due to large chunk of data that you`re trying to save.
To be sure about operation success you can try to snapshot your dashboard withing the same time range manually.  

###Build image
```docker build -t puppeteer-chrome-grafana-snapshooter:latest .```

###Run container
```
docker run -it --rm --cap-add=SYS_ADMIN --name snapshooter \
    -v ./results:/app/results \
    -e "GRAFANA_URL=https://your-grafana-host.net" \
    -e "LOGIN=grafana-user-login" \
    -e "PASSWORD=grafana-user-password" \
    -e "DASHBOARD_URL=https://your-grafana-host.net/full/dashboard/path?from=startTimestampInMs&to=endTimestampInMs" \
    -e "SNAPSHOT_NAME=[SOME][TAGS] Snapshot Name" \
    -e "REPORT_NAME=output-json-file-name-without-extension" \
    puppeteer-chrome-grafana-snapshooter:latest node snapshot.js
```

